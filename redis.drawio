<mxfile host="app.diagrams.net" modified="2021-09-02T06:59:37.536Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36" etag="5LLBiA7iaa79AgRq5x52" version="15.0.3" type="github" pages="7">
  <diagram id="2Xkt2TAEOzTNxrY3dc94" name="数据结构">
    <mxGraphModel dx="868" dy="492" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="DcSzvV2dXJmABJle09KA-1" value="redis&amp;nbsp; 的 5中数据结构" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="10" y="30" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-2" value="string：字符串" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="50" y="70" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-3" value="hash：哈希" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="62.5" y="690" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-5" value="list:列表" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="60" y="400" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-6" value="zset：有序集合" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="62.5" y="1190" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-7" value="set：集合" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="62.5" y="1040" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-8" value="&lt;font color=&quot;#1a1a1a&quot; style=&quot;font-size: 13px ; line-height: 190%&quot;&gt;redis 的字符串是动态字符串，是可以修改的字符串，内部结构类似于 Java的ArrayList , 采用预分配冗余空间的方式来减少内存的频繁分配，字符串的最大长度是 512M&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="87.5" y="100" width="710" height="50" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-9" value="&lt;font color=&quot;#1a1a1a&quot; style=&quot;font-size: 13px ; line-height: 150%&quot;&gt;Redis 的列表相当于Java语言里面的LinkedList , 注意它是链表而不是数组 ， 这意味着&amp;nbsp; 插入和删除操作非常的快 ，时间复杂度 O(1) , 但是索引定位很慢 ，时间复杂度 O(n)&amp;nbsp;&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;当列表弹出最后一个元素之后 ， 该数据结构自动被删除， 内存被回收。&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;Redis 的列表用来做异步队列使用，将需要延后处理的任务结构体序列化成字符串塞进Redis列表。另一个线程从这个列表中轮询数据进行处理。&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;快速链表： redis底层存储的还不是一个简单的LinkedList ,而是称之为快速链表quicklist的结构，首先在链表元素较少的情况下使用一块连续的存储存储，这个结构是 ziplist , 压缩列表。当数据量比较多的时候才会改成 quicklist&amp;nbsp; ,&amp;nbsp;&lt;br&gt;&lt;br&gt;最大存储元素， 2 ^ 32 -1&amp;nbsp;&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="90" y="440" width="700" height="220" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-10" value="&lt;font color=&quot;#1a1a1a&quot; style=&quot;font-size: 13px ; line-height: 160%&quot;&gt;Redis的字典相当于Java语言里面的 HashMap , 它是无序字典。 内部实现结构上同 Java的Hashmap 也是一致的 ，同样的数组 + 链表的 二维结构 。第一维 hash 的数组位置碰撞时，就会将碰撞的元素使用链表串接起来。&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="87.5" y="720" width="690" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-11" value="0" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="92.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-12" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="132.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-13" value="2" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="172.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-14" value="3" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="212.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-15" value="4" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="252.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-16" value="5" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="292.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-17" value="6" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="332.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-18" value="7" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="372.5" y="800" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-19" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="132.5" y="850" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-12" target="DcSzvV2dXJmABJle09KA-19" edge="1">
          <mxGeometry x="7.5" y="320" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-21" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="212.5" y="850" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-14" target="DcSzvV2dXJmABJle09KA-21" edge="1">
          <mxGeometry x="7.5" y="320" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" target="DcSzvV2dXJmABJle09KA-24" edge="1">
          <mxGeometry x="7.5" y="320" as="geometry">
            <mxPoint x="232.5" y="870" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-24" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="212.5" y="900" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" target="DcSzvV2dXJmABJle09KA-26" edge="1">
          <mxGeometry x="7.5" y="320" as="geometry">
            <mxPoint x="352.5" y="820" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-26" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="332.5" y="850" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" target="DcSzvV2dXJmABJle09KA-28" edge="1">
          <mxGeometry x="7.5" y="320" as="geometry">
            <mxPoint x="350.5" y="870" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-28" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="332.5" y="900" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-30" value="&lt;font color=&quot;#1a1a1a&quot; style=&quot;font-size: 13px&quot;&gt;Redis的集合相当于Java语言里面的 HashSet , 它的内部是无序的唯一的 。 它的内部实现相当于一个特殊的字典，字典中所有的Value 都是一个值 NULL&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;当集合中的最后一个元素被移除后 ， 数据结构自动删除，内存被回收。 元素不能重复&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="87.5" y="1080" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-31" value="&lt;font color=&quot;#1a1a1a&quot; style=&quot;font-size: 13px ; line-height: 180%&quot;&gt;zset 可能是Redis提供的最出色的数据结构， 它类似于Java 的SortSet 和HashMap 的结合体。 一方面它是 set ,保证了内部Value的唯一性，另一个方面它可以给每个value 赋予一个score ,&amp;nbsp; 代表这个value 的排序权重 ， 它的内部实现用 一种叫 跳跃列表 的数据结构 。&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;zset 中最后一个value&amp;nbsp; 被移除后， 数据结构自动删除， 内存被回收。&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;br style=&quot;font-size: 13px&quot;&gt;zset 内部的排序功能是通过跳跃列表 数据结构来实现的 ，它的结构比较的特殊 ， 也比较的复杂&lt;br style=&quot;font-size: 13px&quot;&gt;跳跃列表 采用随机策略 来决定新元素可以兼职到第几层。&amp;nbsp; &amp;nbsp;增加多级索引来提升查找效率&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="90" y="1220" width="720" height="190" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-32" value="Redis 锁超时问题" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="77.5" y="1850" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-33" value="Redis的分布式锁不能解决超时的问题， 如果在加锁和释放锁之间的逻辑执行的太长 ， 以致于超出了锁的超时时间限制，就会出现问题， 因为这个时候锁过期了，第二个线程重新持有了这把锁 ，但是紧接着第一个线程执行完了业务逻辑 ，就把锁给释放了， 第三个线程就会在第二个线程逻辑执行完之前拿到锁。&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;为了避免这个问题，redis 分布式锁不要用于长时间的任务，如果真的偶尔出现了，数据出现的小波错乱可能需要人工的介入解决。&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;有一个更加安全的方案就是set 指令的value ,设置为一个随机数， 释放锁时先匹配随机数是否一致 ， 然后在删除key , 但是匹配value 和删除 key 不是一个原子操作 ，redis 也没有提供类似于 delifequals这样的指令， 这就需要使用lua 脚本来处理了。&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="111.25" y="1880" width="682.5" height="160" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-34" value="Redis 延时队列" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="90" y="2070" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-35" value="redis 的消息队列不是专业的消息队列，它没有非常多的高级特性 ，没有ack 保证 ，如果对消息的可靠性有着极致的要求 ， 那么它不适合使用。&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;Redis 的list 列表 数据结构常用来作为异步消息队列使用，使用 rpush/lpush 操作入队列 ， 使用 lpop 和 rpop 来出队列" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="130" y="2110" width="680" height="90" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-36" value="key" style="ellipse;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="135" y="2242.5" width="55" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-39" value="" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="365" y="2242.5" width="46" height="25" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-40" value="" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="411" y="2242.5" width="46" height="25" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-41" value="" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="457" y="2242.5" width="46" height="25" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-42" value="" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="503" y="2242.5" width="46" height="25" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-43" value="" style="endArrow=classic;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;" parent="1" target="DcSzvV2dXJmABJle09KA-39" edge="1">
          <mxGeometry x="40" y="900" width="50" height="50" as="geometry">
            <mxPoint x="320" y="2290" as="sourcePoint" />
            <mxPoint x="365" y="2267.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-44" value="" style="endArrow=classic;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-39" edge="1">
          <mxGeometry x="40" y="900" width="50" height="50" as="geometry">
            <mxPoint x="365" y="2242.5" as="sourcePoint" />
            <mxPoint x="320" y="2240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-45" value="lpush" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="285" y="2290" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-46" value="lpop" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="285" y="2222.5" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-47" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-42" edge="1">
          <mxGeometry x="40" y="900" width="50" height="50" as="geometry">
            <mxPoint x="330" y="2300" as="sourcePoint" />
            <mxPoint x="600" y="2230" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-48" value="" style="endArrow=classic;html=1;fontSize=13;" parent="1" edge="1">
          <mxGeometry x="40" y="900" width="50" height="50" as="geometry">
            <mxPoint x="600" y="2280" as="sourcePoint" />
            <mxPoint x="550" y="2260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-49" value="rpush" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="600" y="2270" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-50" value="rpop" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="600" y="2220" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-51" value="" style="shape=flexArrow;endArrow=classic;html=1;fontSize=13;" parent="1" edge="1">
          <mxGeometry x="40" y="900" width="50" height="50" as="geometry">
            <mxPoint x="220" y="2260" as="sourcePoint" />
            <mxPoint x="280" y="2260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-52" value="阻塞队列：blpop/ brpop 会抛出异常来&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;空闲连接问题 ， 如果线程一致阻塞在哪里 ， redis 客户端连接就成了闲置连接，闲置久了，服务器一般会主动的断开连接 ， 较少闲置资源占用 ，要注意捕获异常， 还要重试" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="135" y="2330" width="685" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-54" value="布隆过滤器" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="85" y="2490" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-55" value="布隆过滤器 ， 可以理解为一个不怎么精确的set 结构 ， 当你使用它的contains 方法判断某个对象是否存在时， 它可能会误判 ，&amp;nbsp; 但是布隆过滤器也不是那么的准确， 只要参数设置的合理 ， 它的精确度可以控制的相对足够准确， 只会有小小的误判概率。&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;当布隆过滤器说某个值存在时 ， 这个值可能不存在， 当它说不存在时， 那就肯定不存在。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="135" y="2524" width="685" height="100" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-56" value="原理：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="130" y="2640" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-57" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="140" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-58" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="180" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-59" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="220" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-60" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="260" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-61" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="300" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-62" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="340" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-63" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="380" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-64" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="420" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-65" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="460" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-66" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="500" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-67" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="540" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-68" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="580" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-69" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="620" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-70" value="1" style="rounded=0;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="660" y="2720" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-75" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" target="DcSzvV2dXJmABJle09KA-59" edge="1">
          <mxGeometry x="40" y="900" as="geometry">
            <mxPoint x="300" y="2660" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-76" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-73" target="DcSzvV2dXJmABJle09KA-62" edge="1">
          <mxGeometry x="40" y="900" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="2660" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-77" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-73" target="DcSzvV2dXJmABJle09KA-65" edge="1">
          <mxGeometry x="40" y="900" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-73" value="key" style="ellipse;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="275" y="2630" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-78" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-74" target="DcSzvV2dXJmABJle09KA-62" edge="1">
          <mxGeometry x="40" y="900" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-79" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-74" target="DcSzvV2dXJmABJle09KA-70" edge="1">
          <mxGeometry x="40" y="900" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-80" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=13;" parent="1" source="DcSzvV2dXJmABJle09KA-74" target="DcSzvV2dXJmABJle09KA-67" edge="1">
          <mxGeometry x="40" y="900" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-74" value="key" style="ellipse;whiteSpace=wrap;html=1;align=center;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="499" y="2630" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-81" value="布隆过滤器添加元素时 ， 会使用多个hash函数对key 进行 hash 算得一个整数索引值 ， 然后对位数组长度进行取模 ，得到一个位置，每个hash函数都会算得一个不同的位置， 然后在把数组的这几个位置都置为1 就完成了add 操作 。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="140" y="2790" width="670" height="90" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-82" value="大 key 扫描" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="95" y="2900" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-83" value="在集群环境下 ，某个key 太大 ， 会导致 redis 数据迁移卡顿 ， 另外在 内存分配上， 一个key 太大 ， 那么当它需要扩容时 ， 会一次性申请更大的内存 ， 这也会导致卡顿 。如果这个大key&amp;nbsp; 被删除，内存会一次性的回收， 卡断现象会在一次产生。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="135" y="2940" width="675" height="70" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-84" value="如何定位大key&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="130" y="3030" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-85" value="使用 scan 指令 ，对于扫描出来的每一个 key , 使用type 指令 获取key 的类型 ，然后使用相应数据结构的size 或者 len 方法来得到它的大小 ，对于每一种类型 ，保留大小的前 N 名作为 扫描结果展示出来。&lt;br style=&quot;font-size: 13px;&quot;&gt;&lt;br style=&quot;font-size: 13px;&quot;&gt;redis-cli -h 127.0.0.1 -p 7001 --bigkeys&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="1" vertex="1">
          <mxGeometry x="140" y="3070" width="670" height="70" as="geometry" />
        </mxCell>
        <mxCell id="7rDChKDpcRugUD0UEgwR-5" value="" style="group;rotation=-15;textOpacity=20;fontSize=13;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="119" y="1600" width="650" height="210" as="geometry" />
        </mxCell>
        <mxCell id="7rDChKDpcRugUD0UEgwR-6" value="&lt;span style=&quot;font-size: 13px;&quot;&gt;&lt;font color=&quot;#b3b3b3&quot; style=&quot;font-size: 13px;&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;fontSize=13;" parent="7rDChKDpcRugUD0UEgwR-5" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-29" value="Hash 也有缺点 ， hash结构的存储消耗要高于单个字符串，到底该使用hash还是字符串，需要根据具体情况确定" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="7rDChKDpcRugUD0UEgwR-5" vertex="1">
          <mxGeometry x="347.5" y="-765" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="DcSzvV2dXJmABJle09KA-53" value="HyperLogLog" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="7rDChKDpcRugUD0UEgwR-5" vertex="1">
          <mxGeometry x="-49" y="140" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="BkFgR9PnLJ1pPxzbfbDE-1" value="统计网站uv" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" parent="7rDChKDpcRugUD0UEgwR-5" vertex="1">
          <mxGeometry x="-4" y="190" width="75" height="20" as="geometry" />
        </mxCell>
        <mxCell id="7rDChKDpcRugUD0UEgwR-7" value="" style="group;rotation=-15;textOpacity=20;fontSize=13;" parent="1" vertex="1" connectable="0">
          <mxGeometry x="140" y="2490" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="7rDChKDpcRugUD0UEgwR-8" value="&lt;span style=&quot;font-size: 13px;&quot;&gt;&lt;font color=&quot;#b3b3b3&quot; style=&quot;font-size: 13px;&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;fontSize=13;" parent="7rDChKDpcRugUD0UEgwR-7" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-4" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-3" target="toykxD1ecs2tBxbDtwPN-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="262.5" y="1525" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-7" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="332.5" y="1510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-13" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="322.5" y="1570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-18" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="472.5" y="1630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="322.5" y="1590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-23" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;entryX=0.092;entryY=0.188;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-3" target="toykxD1ecs2tBxbDtwPN-24">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="232.5" y="1610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-3" value="key" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="92.5" y="1510" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-5" value="i am a string" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="307.5" y="1440" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-6" value="字符串" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="447.5" y="1445" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-8" value="f1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="332.5" y="1500" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-9" value="v1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="402.5" y="1500" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-10" value="f2" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="332.5" y="1520" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-11" value="v2" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="402.5" y="1520" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-12" value="hash" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="492.5" y="1510" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-14" value="a" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="325.5" y="1560" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-15" value="b" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="385.5" y="1560" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-16" value="c" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="445.5" y="1560" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-17" value="list" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="527.5" y="1560" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-19" value="" style="ellipse;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="477.5" y="1599" width="105" height="60" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-20" value="a" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="505" y="1609" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-21" value="b" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="545" y="1619" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-22" value="c" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="520" y="1634" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-24" value="" style="ellipse;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="307.5" y="1619" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-25" value="a:1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="327.5" y="1639" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-26" value="b:2" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="362.5" y="1659" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-27" value="底层使用sds 结构来封装 ，结构图如下：" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="50" y="160" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-29" value="sdshdr" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="215" y="220" width="75" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-30" value="free" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="215" y="250" width="75" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-31" value="len" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="215" y="280" width="75" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-39" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-32">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="325" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-32" value="buf" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="215" y="310" width="75" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.96;exitY=0.7;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;curved=1;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-33" target="toykxD1ecs2tBxbDtwPN-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-33" value="buf 中空闲的列表强度" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="30" y="210" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-36" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.13;exitY=0.77;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-35" target="toykxD1ecs2tBxbDtwPN-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-35" value="记录buf中已使用的空间" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="404" y="240" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-38" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.96;exitY=0.7;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;" edge="1" parent="1" source="toykxD1ecs2tBxbDtwPN-37" target="toykxD1ecs2tBxbDtwPN-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-37" value="实际存储的内容" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="30" y="290" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-40" value="实" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="320" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-41" value="际" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="370" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-42" value="存" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="420" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-43" value="储" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="470" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-44" value="内" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="521" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-45" value="容" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="571" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-46" value="\0" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="621" y="310" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-48" value="struct sdshdr{&lt;br&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;unsigned int len ;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;unsigned int free ;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;char buf[] ;&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="610" y="140" width="159" height="120" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-49" value="开发如果使用 hgetall , 哈希元素 元素如果比较多的话 ， 可能导致Redis阻塞 ， &lt;br&gt;可以使用 hscan , 如果只是获取部分的 field , 建议使用 hmget" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="77.5" y="960" width="470" height="40" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-50" value="redis 为什么快？" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="55" y="3200" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-51" value="基于内存实现" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="70" y="3240" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-52" value="高效的数据结构" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="65" y="3270" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-53" value="合理的数据编码" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="62.5" y="3300" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-54" value="单线程 避免了上下文切换" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="65" y="3330" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="toykxD1ecs2tBxbDtwPN-57" value="采用io 多路复用模型" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="70" y="3360" width="130" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="T9ofhpVVGzbZsa4hbkmA" name="原理">
    <mxGraphModel dx="868" dy="492" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="bH2euOrN30Yw1Qwi_7RK-0" />
        <mxCell id="bH2euOrN30Yw1Qwi_7RK-1" parent="bH2euOrN30Yw1Qwi_7RK-0" />
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-26" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="630" y="1035" width="190" height="75" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-58" value="" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="104" y="480" width="683" height="265" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-0" value="线程IO 模型：&lt;br&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="40" y="40" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-1" value="Redis 是个单线程程序。&amp;nbsp; redis 6.0 已经出了多线程版本，不过是用多个线程处理客户端的连接&amp;nbsp; ， 对事件的处理还是单线程的" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="77.5" y="77" width="710" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-2" value="所有的数据都在内存中，所有的运算都是内存级别的。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="110" width="430" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-3" value="采用多路复用 ，非阻塞的IO&amp;nbsp; ,可以同时处理多个客户端连接" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="142" width="430" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-4" value="事件轮询：" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="180" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-5" value="select&amp;nbsp; &amp;nbsp;poll&amp;nbsp; epoll" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="110" y="210" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-6" value="指令队列：" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="250" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-7" value="Redis&amp;nbsp; 会将每个客户端套接字都关联一个指令队列， 客户端的指令 通过队列来排队进行顺序处理任务" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="110" y="280" width="570" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-8" value="响应队列：" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="330" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-9" value="Redis 同样也会为每个客户端套接字关联一个响应队列 ，Redis 服务器通过响应队列来将指令的返回结果返回给客户端。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="110" y="360" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-19" value="通信协议：" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="37" y="800" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-20" value="持久化：" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="40" y="910" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-21" value="Redis 的持久化机制有两种： 快照&amp;nbsp; &amp;nbsp; AOF文件&amp;nbsp; &amp;nbsp;redis 4.0 之后增加了混合持久化&lt;br&gt;&lt;br&gt;快照时一次全量备份 ， AOF 文件 是增量备份， 记录的命令操作 。&lt;br&gt;&lt;br&gt;快照是内存数据的二进制序列化形式 ， 在存储上非常紧凑 ，&amp;nbsp; 而AOF 日志记录的是内存数据修改的指令记录文本。AOF 日志在长期的运行过程中会变得无比的庞大， 所以需要定期进行 aof 日志重写 ， 给 aof 日志进行瘦身。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="82.12" y="945" width="742.5" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Ze0R76dbrBJB77nGCg3R-0" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.855;exitY=1;exitDx=0;exitDy=-4.35;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-22" target="AXepTas1otN2ZdD5XDQn-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-22" value="快照" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=12;align=center;rotation=30;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="125.12" y="1117.8899999999999" width="47" height="63" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-23" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="350" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-24" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="400" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-25" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="450" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-26" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="500" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-34" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-27" target="AXepTas1otN2ZdD5XDQn-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-27" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="550" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-28" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="600" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-29" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="650" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-30" value="" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="700" y="1140" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-31" value="aof&amp;nbsp; 日志" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="510" y="1110" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-32" value="redis&amp;nbsp; 内存" style="rounded=0;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="270" y="1217" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-36" value="fork 多进程 ： 快照" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;glass=0;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="1270" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-37" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;Redis 在持久化式会调用 glibc 的函数， fork 产生一个子进程 ， 快照持久化完全交给子进程来处理 ， 父进程继续处理客户端请求 。 子进程刚刚产生，它和父进程共享内存里面的代码段和数据段 ， 这时可以将父子进程想象成一个连体婴儿 ， 共享身体。 子进程做数据持久化 ， 它不会修改现有的内存数据结构 ，它只是针对数据结构进行遍历读写，然后序列化写到磁盘中。数据段是由很多的操作系统的页面组合而成 ，当父进程对其中一个页面的数据进行修改时 ，会将被共享的页面复制一份出来 ， 然后对这个复制的页面进行修改 ， 这时 子进程相应的页面没有变化 ， 还是进程产生时那一瞬间的数据 。 子进程尝试将数据dump 到临时的rdb 快照文件中，完成rdb 快照文件的生成之后，就替换之前的快照文件，dump.rdb , 每次生成一个新的快照，就会覆盖之前老的快照，dump.rdb 只有一个&lt;/font&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;spacingBottom=0;spacing=0;spacingLeft=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="120" y="1300" width="700" height="180" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-6" value="文件事件处理器：是单线程，所以redis 才是单线程的" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="82" y="400" width="488" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-8" value="Redis 进程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="415.5" y="485" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;curved=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-10" target="ngkLmRye4pmdnFh268Ew-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-43" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.017;entryY=0.257;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-10" target="ngkLmRye4pmdnFh268Ew-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-10" value="客户端" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="24" y="505" width="73" height="45" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-11" value="客户端" style="ellipse;whiteSpace=wrap;html=1;align=center;strokeColor=#6c8ebf;fillColor=#dae8fc;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="21" y="580" width="73" height="45" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-12" value="客户端" style="ellipse;whiteSpace=wrap;html=1;align=center;strokeColor=#6c8ebf;fillColor=#dae8fc;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="21" y="650" width="73" height="45" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-17" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="250" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-13" value="server socket" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="140" y="572.5" width="70" height="45" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-15" value="请求建立连接" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="110" y="530" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-19" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-18" target="ngkLmRye4pmdnFh268Ew-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="287" y="590" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-18" value="AE_READABLE" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="210" y="480" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-21" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-20" target="ngkLmRye4pmdnFh268Ew-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="390" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-20" value="IO 多路复用程序" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="234" y="580" width="106" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-30" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="600" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-22" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3c800;strokeColor=#B09500;fontColor=#ffffff;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="370" y="582.5" width="200" height="35" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-25" value="队列" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="455" y="540" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-35" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.4;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-26" target="ngkLmRye4pmdnFh268Ew-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-51" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="720" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-56" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-26" target="ngkLmRye4pmdnFh268Ew-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-26" value="文件事件派发器" style="rounded=1;whiteSpace=wrap;html=1;align=center;fillColor=#bac8d3;strokeColor=#23445d;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="600" y="585" width="94" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-42" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.625;entryY=0.2;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-31" target="ngkLmRye4pmdnFh268Ew-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-31" value="连接应答处理器" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#fad9d5;strokeColor=#ae4132;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="725" y="495" width="55" height="55" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-49" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.4;entryY=0.1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-32" target="ngkLmRye4pmdnFh268Ew-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-32" value="命令请求处理器" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#fad9d5;strokeColor=#ae4132;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="725" y="565" width="55" height="55" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-57" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.526;entryY=0.1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-33" target="ngkLmRye4pmdnFh268Ew-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-33" value="命令回复处理器" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#fad9d5;strokeColor=#ae4132;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="725" y="640" width="55" height="55" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-37" value="文件事件处理器模型" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="399.31" y="440" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="C-YC8vFVnVTkTuF-1k0M-0" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="170" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-38" value="与socket 建立关联" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;align=center;fillColor=#b1ddf0;strokeColor=#10739e;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="462.75" y="735" width="124.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C-YC8vFVnVTkTuF-1k0M-1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-39" target="ngkLmRye4pmdnFh268Ew-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-39" value="从socket 中读取数据&lt;br&gt;完成相应的命令操作&lt;br&gt;并与命令回复器建立关联" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;align=center;fillColor=#b1ddf0;strokeColor=#10739e;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="560" y="790" width="160" height="100" as="geometry" />
        </mxCell>
        <mxCell id="C-YC8vFVnVTkTuF-1k0M-2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-40" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="170" y="770" as="targetPoint" />
            <Array as="points">
              <mxPoint x="727" y="890" />
              <mxPoint x="170" y="890" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-40" value="返回结果，并与socket 解除关联" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;align=center;fillColor=#b1ddf0;strokeColor=#10739e;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="670" y="740" width="114.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="C-DDhQpqBLK7wEynkvs0-0" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-41" target="ngkLmRye4pmdnFh268Ew-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C-DDhQpqBLK7wEynkvs0-1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-41" target="ngkLmRye4pmdnFh268Ew-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-41" value="&amp;nbsp;socket" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="140" y="640" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-48" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-45" target="ngkLmRye4pmdnFh268Ew-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-45" value="AE_READABLE" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="240" y="650" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-52" value="&lt;font color=&quot;#cc0000&quot;&gt;将事件压入队列&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;rotation=90;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="305" y="590" width="95" height="10" as="geometry" />
        </mxCell>
        <mxCell id="C-DDhQpqBLK7wEynkvs0-2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ngkLmRye4pmdnFh268Ew-54" target="ngkLmRye4pmdnFh268Ew-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-54" value="AE_WRITEABLE" style="ellipse;whiteSpace=wrap;html=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="350" y="685" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="z3oJRxSje1oIvuxIP5Mp-0" value="Gossip&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="82.12" y="840" width="122.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-2" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="80" y="675" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-3" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-2" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-3" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-1" target="yQ0uILBsWEMAl1AqhaMr-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-1" target="yQ0uILBsWEMAl1AqhaMr-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="180" y="1560" />
              <mxPoint x="320" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-1" target="yQ0uILBsWEMAl1AqhaMr-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-1" value="主线程" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;glass=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="140" y="1490" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;endArrow=none;endFill=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="654" y="1630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-2" value="bgsave&amp;nbsp;&lt;br&gt;子进程" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;sketch=0;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="614" y="1485" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-4" value="" style="rounded=0;whiteSpace=wrap;html=1;opacity=30;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="259" y="1565" width="321" height="95" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-5" value="键值对kv&amp;nbsp; A" style="rounded=1;whiteSpace=wrap;html=1;opacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="280" y="1580" width="80" height="25" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-6" target="yQ0uILBsWEMAl1AqhaMr-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-6" value="键值对kv&amp;nbsp; B" style="rounded=1;whiteSpace=wrap;html=1;opacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="280" y="1620" width="80" height="25" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-9" value="读取" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="220" y="1540" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-10" value="修改" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="190" y="1610" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="yQ0uILBsWEMAl1AqhaMr-11" target="yQ0uILBsWEMAl1AqhaMr-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-11" value="键值对kv&amp;nbsp; B" style="rounded=1;whiteSpace=wrap;html=1;opacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="470" y="1620" width="80" height="25" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-13" value="复制" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="393.5" y="1610" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-14" value="副本" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="495" y="1600" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-15" value="磁盘" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;opacity=50;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="750" y="1617.5" width="54" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-18" value="读取" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="600" y="1610" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-19" value="写快照" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="685" y="1610" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-21" value="混合持久化机制 ，把数据以RDB的方式写入文件，在将后续的操作命令 以AOF 的格式存储文件。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="79.25" y="1060" width="520.75" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-22" value="RDB格式" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="640" y="1045" width="80" height="25" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-23" value="AOF格式" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="640" y="1070" width="80" height="25" as="geometry" />
        </mxCell>
        <mxCell id="yQ0uILBsWEMAl1AqhaMr-25" value="appendonly.aof" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=0;sketch=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="753" y="1065" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-38" value="AOF 原理" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="1680" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-39" value="&lt;p style=&quot;line-height: 190%&quot;&gt;AOF 日志存储的是Redis 服务器的顺序指令序列 ，AOF 日志只记录对内存进行修改的指令记录。&lt;br&gt;&lt;br&gt;Redis在收到客户端修改指令后，先进行参数校验，如果没问题，就立即将该指令文本存储到 AOF 日志中，也就是先存到磁盘，然后在执行指令。 这样即使遇到突发宕机 ， 已经存储到AOF日志的指令进行重放一下 ，就可以恢复到宕机前的准备。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="1720" width="660" height="90" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-40" value="AOF 重写&amp;nbsp;" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;glass=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="121.62" y="1840" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-41" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 提供了 bgrewirteaof 指令对aof 日志进行瘦身 ，其原理即使开辟一个子进程对内存进行遍历转换成一系列Redis 的操作指令，序列化到一个新的AOF日志文件中，序列化完毕后 ，在将操作期间发生的AOF 日志追加到新的AOF日志文件中，追加完毕后，就立即替代旧的AOF日志文件了 ，瘦身工作就完成了。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="160" y="1893.5" width="663" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-49" value="AOF文件" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="623" y="1953.5" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-50" value="os cache" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="408.5" y="1998.5" width="80" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-53" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.16;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-51" target="AXepTas1otN2ZdD5XDQn-50" edge="1">
          <mxGeometry x="43" y="1680" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-51" value="redis&amp;nbsp; server" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="173" y="2008.5" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-55" value="fsync" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="293" y="1973.5" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-56" value="将指定文件的内容强制从内核缓存刷到磁盘 ， 生成环境中 ， 通常是每隔1s 左右执行一次 fsync操作" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="158" y="2083.5" width="540" height="40" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-1" value="优缺点" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="80" y="2140" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-2" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;RDB：优点&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;RDB会生成多个数据文件，每个数据文件都代表了某一个时刻中redis的数据，这种多数据文件的方式，每个文件都代表了某一个时刻的完整数据快照，非常适合做冷备&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;对外提供的读写服务，影响非常的小，可以让redis保持高性能，因为redis fork 一个子进程，让子进程执行磁盘io 操作来进行rdb 的持久化&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;相对与AOF 持久化机制来说 ，直接基于RDB 数据文件来重启和恢复Redis 数据， 会更加的快速&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="124.31" y="2180" width="681.38" height="190" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-3" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;RDB：缺点&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;如果想要在Redis故障时，尽可能小的丢失数据，那么RDB没有AOF 好 ，一般来说 RDB的快照文件都是每隔5分钟，或者更长的时间生成一次，这个时候如果宕机，那么就会丢失5分钟甚至是更长时间的数据。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;RDB每次在fork 一个子进程来执行RDB 快照文件的生成时，如果数据文件比较大，可能会导致客户端提供的服务暂停数毫秒甚至数秒，一般不要让RDB 的间隔时间太长，否则每次生成的RDB 文件太大了， 对Redis 本身的性能可能会有影响&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="2378" width="700" height="140" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-6" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;AOF：优点&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AOF 可以更好的保证数据的不丢失，一般AOF 会每隔1s ，通过一个后台线程执行一次 「 FSYNC 」 操作 ，最多丢失1s的数据，每隔1s 就执行一次 fsync 操作， 保证os cache 的数据写入到硬盘中，redis 进程挂了，最多丢失 1s 的数据。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AOF日志文件以 append-only 默写写入，所有没有磁盘寻址的开销 ，写入性能非常的高，而且文件不容易破损，即使文件尾部破损，也很容易修复&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AOF日志文件即使过大的时候， 后台会出现 「 REWRITE 」操作 ，不会影响客户端的读写，因为在 rewrite log 的时候 ，会对其中的指令进行压缩 ，创建出一份需要恢复数据的最小日志出来 ，在创建新日志文件的时候 ，老的日志文件还是照常写入，当新的merge 后的日志 ready 的时候 ，在交换新老日志文件&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; AOF日志文件的命令通过非常可读的方式进行记录，这个特性非常适合灾难性的误删除后的紧急恢复。&lt;/span&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="122.5" y="2700" width="690" height="250" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-7" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;AOF：缺点&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;对于同一份数据来说 ， AOF 日志文件通常比RDB数据快照文件要大&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AOF 开启之后 ，支持写的QPS 会比 RDB 支持的QPS 低 ，因为AOF 一般会设置 每秒 FSYNC 一次日志文件&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;做数据恢复的时候，会比较的慢 ，还有做冷备 定期的备份，不太方便，可能要自己手写复杂的脚本去做，不太适合做冷备&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="122.5" y="2980" width="681.38" height="130" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-46" value="" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fontSize=12;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="633" y="1993.5" width="40" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-54" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-50" target="AXepTas1otN2ZdD5XDQn-46" edge="1">
          <mxGeometry x="43" y="1680" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-57" value="管道" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="43" y="3300" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-58" value="管道 本身不是 Redis服务器直接提供的技术 ，这个技术本质上是由客户端提供的，跟服务器没有什么直接的关系" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="105" y="3340" width="660" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-59" value="事务" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="43.5" y="3380" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-60" value="multi /exec / discard&amp;nbsp;&amp;nbsp;&lt;br&gt;&lt;br&gt;multi 指示 事务的开始 ，&amp;nbsp; exec 指示事务的执行&amp;nbsp; discard 指示 事务的丢弃&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="93" y="3420" width="660" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-61" value="&lt;p style=&quot;line-height: 180%&quot;&gt;所有的指令在exec 之前 不执行 ， 而是缓存在服务器的一个事务队列中 ， 服务器一旦收到exec 指令 ， 才开始执行整个事务队列 ， 执行完毕后一次性返回所有指令的执行结果 ， redis事务根本不能算 原子性， 而仅仅是满足了事务的隔离性 ， 隔离性中的串行化&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="93" y="3480" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-62" value="pub/sub - 发布订阅模型" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="46.12" y="3560" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-63" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Pub Sub 的生产者传递过来一个消息， Redis 会直接找到相应的消费者传递过去， 如果一个消费者都没有， 那么消息直接丢弃 ，如果开始又三个消费者，一个消费者突然挂掉了，生产者会继续发送消息，另外两个消费者可以持续收到消息， 但是挂掉的消费者重新连上的时候， 这段时间生产者发送的消息， 对于整个消费者来说就是彻底的丢失了。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;如果Redis 停机重启 ， PubSub 的消息是不会持久化的， 毕竟 Redis 宕机就相当于一个消费者都没有 ，&amp;nbsp; 所有的消息直接被丢弃。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="93" y="3620" width="710" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-65" value="主从同步" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="48" y="3750" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-66" value="CAP原理" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="3820" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-67" value="&lt;p style=&quot;line-height: 180%&quot;&gt;C - Consistent : 一致性&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;A - Availability : 可用性&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;P - Partition tolerance , 分区容忍性&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;网络分区发生时， 一致性和可用性两难全&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="3870" width="270" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-68" value="最终一致" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="4010" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-69" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 的主从同步是异步复制的 ， 所以分布式的Redis 系统并不满足一致性的要求 ， Redis 保证 【最终一致】&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="4050" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-70" value="主从同步" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="4110" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-71" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 同步支持主从同步和从从同步 。从从同步功能是Redis 后续版本增加的功能 ，为了减轻主库的同步负担&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="4150" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-72" value="Master&amp;nbsp;" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="138" y="4230" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-77" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-73" edge="1">
          <mxGeometry x="38" y="3270" as="geometry">
            <mxPoint x="423" y="4220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-73" value="slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="273" y="4200" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-75" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-72" target="AXepTas1otN2ZdD5XDQn-73" edge="1">
          <mxGeometry x="38" y="3270" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-79" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-74" edge="1">
          <mxGeometry x="38" y="3270" as="geometry">
            <mxPoint x="423" y="4300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-74" value="slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="273" y="4280" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-76" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.014;entryY=0.675;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-72" target="AXepTas1otN2ZdD5XDQn-74" edge="1">
          <mxGeometry x="38" y="3270" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-78" value="slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="423" y="4200" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-80" value="slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="428" y="4280" width="65" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-81" value="replicate" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="208" y="4200" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-83" value="replicate" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="203" y="4280" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-84" value="replicate" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="363" y="4200" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-85" value="replicate" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="363" y="4280" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-86" value="增量同步" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="4350" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-87" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 同步的是指令流 ，主节点会将哪些对自己的状态产生修改性影响的指令记录在本地的内存buffer 中， 然后异步将buffer 中的指令同步到 从节点 ，从节点一边执行同步的指令流来达到和主节点一样的状态 ， 一边向主节点反馈自己同步到哪里了(偏移量)&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;因为内存的buffer 是有限的， 所以Redis 主库不能将所有的指令都记录在内存buffer 中 ，Redis 的复制内存buffer 是一个定长的环形数组，如果数组内容满了， 就会从头开始覆盖前面的内容。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="116" y="4390" width="700" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-88" value="快照同步" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="83" y="4513" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-89" value="&lt;p style=&quot;line-height: 200%&quot;&gt;快照同步是一个非常耗费资源的操作， 它首先需要在主库上进行一次bgsave 将当前内存的数据全部快照到磁盘上，然后再将快照文件的内容全部传送到从节点 ，从节点快照文件接受完毕后，立即执行一次全量加载 ， 加载之前要将当前内存的数据清空，加载完毕后，通知主节点继续增量的同步数据。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="4550" width="700" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-90" value="增加从节点" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="76" y="4670" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-91" value="&lt;p style=&quot;line-height: 180%&quot;&gt;当从节点刚刚加入集群时 ，它必须先要进行一次快照同步 ，同步完成后，在继续进行增量同步&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="123" y="4720" width="690" height="40" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-92" value="无盘复制" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="86" y="4790" width="53" height="20" as="geometry" />
        </mxCell>
        <mxCell id="AXepTas1otN2ZdD5XDQn-93" value="&lt;p style=&quot;line-height: 200%&quot;&gt;无盘复制 ，主服务器直接通过套接字将快照内容发送到从节点 ，生成快照是一个遍历的过程，主节点会一边遍历，一边将序列化的内容发送到从节点，从节点还是和之前一样，先将收到的内容存储到硬盘文件中，在进行一次性加载。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="126" y="4840" width="690" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="AXepTas1otN2ZdD5XDQn-92" target="AXepTas1otN2ZdD5XDQn-92" edge="1">
          <mxGeometry x="41" y="3300" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-38" value="主从复制的原理" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="81" y="4900" width="98" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-39" value="Master" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="81.12" y="5020" width="54.88" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;dashed=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-41" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="139" y="5040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-53" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-41" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="739" y="5070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-54" value="3⃣️" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-53" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-41" value="Slave" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="614.12" y="5020" width="54.88" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-42" value="" style="endArrow=none;html=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" edge="1">
          <mxGeometry x="43" y="1680" width="50" height="50" as="geometry">
            <mxPoint x="79" y="4980" as="sourcePoint" />
            <mxPoint x="679" y="4980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-46" value="&lt;font color=&quot;#00994d&quot;&gt;slave 第一次 连接 master&amp;nbsp; 或长时间断开连接&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-42" vertex="1" connectable="0">
          <mxGeometry x="0.17" y="1" relative="1" as="geometry">
            <mxPoint x="-191" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-45" value="1⃣️&amp;nbsp; 当启动一个slave 的时候，它会发送一个 psync 命令给 master node" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="186" y="5010" width="390" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-47" value="2⃣️ 触发 一次 全量复制&amp;nbsp; full&amp;nbsp; resynchronization&amp;nbsp; master &lt;br&gt;启动一个后台线程，开始生成一份 RDB 快照文件" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="64" y="5090" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-50" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-48" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="639" y="5070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-51" value="快照生成完毕后，发送给 slave" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-50" vertex="1" connectable="0">
          <mxGeometry x="0.1327" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-48" value="RDB" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="96" y="5130" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-49" value="同时会将客户端收到的所有写命令缓存在内存中" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="64" y="5175" width="270" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-57" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.708;entryY=1.1;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.492;exitY=1.033;exitDx=0;exitDy=0;exitPerimeter=0;rounded=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-56" target="ekmjxTff3Y5ltakHXg94-41" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="789" y="5120" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="788" y="5111" />
              <mxPoint x="788" y="5170" />
              <mxPoint x="653" y="5170" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-58" value="然后在加载到内存" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-57" vertex="1" connectable="0">
          <mxGeometry x="-0.0996" y="1" relative="1" as="geometry">
            <mxPoint x="-14.96" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-56" value="slave 收到快照之后&lt;br&gt;先写入本地磁盘" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="679" y="5070" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-60" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-59" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="629" y="5070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-61" value="4⃣️&amp;nbsp; 将内存中缓存的写命令同步给slave" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-60" vertex="1" connectable="0">
          <mxGeometry x="-0.4137" y="-1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-59" value="缓存RDB 复制过程中的写命令" style="ellipse;whiteSpace=wrap;html=1;align=center;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="244" y="5210" width="100" height="45" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-63" value="" style="endArrow=none;html=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" edge="1">
          <mxGeometry x="43" y="1680" width="50" height="50" as="geometry">
            <mxPoint x="81" y="5310" as="sourcePoint" />
            <mxPoint x="681" y="5310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-64" value="&lt;font color=&quot;#00994d&quot;&gt;重新连接&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ekmjxTff3Y5ltakHXg94-63" vertex="1" connectable="0">
          <mxGeometry x="0.17" y="1" relative="1" as="geometry">
            <mxPoint x="-293" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-65" value="Master" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="81.12" y="5340" width="54.88" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="bH2euOrN30Yw1Qwi_7RK-1" source="ekmjxTff3Y5ltakHXg94-69" edge="1">
          <mxGeometry x="43" y="1680" as="geometry">
            <mxPoint x="139" y="5360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-69" value="Slave" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="614.12" y="5340" width="54.88" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ekmjxTff3Y5ltakHXg94-80" value="1⃣️&amp;nbsp; master&amp;nbsp; 仅复制缺少的数据给slave" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="269" y="5340" width="210" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-0" value="过期key 的处理" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="81.12" y="5430" width="87.88" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-3" value="&lt;p style=&quot;line-height: 200%&quot;&gt;slave 不会过期key ，只会等待 master 过期key&amp;nbsp; ，如果master 过期了一个key ， 或者通过 LRU 淘汰了一个key&amp;nbsp; ，那么就会模拟一条del 指令 发送给 slave&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="118.5" y="5490" width="690" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-4" value="断点续传" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="79" y="5560" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="ngkLmRye4pmdnFh268Ew-5" value="&lt;p style=&quot;line-height: 200%&quot;&gt;如果在主从复制的过程中 ，网络连接断掉了，那么可以接着上次复制的地方，继续复制下去，而不是从头开始复制一份ID， offset 就是保存在backlog 中，如果master 和 slave 网络连接断掉了，slave 会让master 从上次的 replica offset 开始继续复制。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1">
          <mxGeometry x="122.62" y="5630" width="690" height="40" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-0" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="107" y="1973.5" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-1" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-0" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-4" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="103" y="2500" width="707" height="180" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-5" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-4" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-4" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;save&amp;nbsp; 60 1000&amp;nbsp; ： 每隔60s ，如果有超过1000个key 发生了变更，那么就生成一个dump.rdb 文件，就是当前redis 内存中完整的数据快照， 这个操作也称为 snapshotting ，快照。 也可以手动调用save 或者 bgsave 命令，同步或者异步执行rdb 快照生成。save 可以设置多个，多是多个 snapshotting 检查点，每到一个检查点，就会去check 一下 ，是否有指定的key 数量发生了变更，如果有 就生成一个dump.rdb&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="a0pn-dlbp93B09sLRIuo-4" vertex="1">
          <mxGeometry x="20" y="40" width="700" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-6" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="93" y="3160" width="729.5" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-7" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-6" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="h00gNlVUUtypoUSbmEtx-8" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;配置&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AOF 默认是关闭的，可以通过&amp;nbsp; appendonly&amp;nbsp; yes&amp;nbsp; 开启。 生成环境中 一般来说是要打开的，除非随便丢失几分钟的数据也无所谓，代开AOF 持久化之后，redis 每次接收到一条写命令 ，就会写入到 日志文件中，当然是先写 os cache 然后每隔一段时间fsync一下。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; AOF 和RDB 都开启的情况下 ，redis重启的时候 ， 会优先从AOF 中进行数据恢复 ， 因为AOF 文件中的数据比较的完整。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;" parent="a0pn-dlbp93B09sLRIuo-6" vertex="1">
          <mxGeometry x="29.5" y="-18" width="700" height="140" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-8" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="100.5" y="4330" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-9" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-8" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-10" value="" style="group;rotation=-15;textOpacity=20;" parent="bH2euOrN30Yw1Qwi_7RK-1" vertex="1" connectable="0">
          <mxGeometry x="76" y="5240" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="a0pn-dlbp93B09sLRIuo-11" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="a0pn-dlbp93B09sLRIuo-10" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="4HDq_m0lPvmAYO2BNJQY" name="集群">
    <mxGraphModel dx="868" dy="-677" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="nV-omL6sR25xKeSbgsDl-0" />
        <mxCell id="nV-omL6sR25xKeSbgsDl-1" parent="nV-omL6sR25xKeSbgsDl-0" />
        <mxCell id="23tLzSuujafjZIG68ccP-12" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;opacity=50;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="125" y="2690" width="590" height="210" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-0" value="Redis Sentinel (哨兵)" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="40" y="1200" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-10" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-1" target="v9Ph8Vd67jHW01WgXYZy-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-1" target="v9Ph8Vd67jHW01WgXYZy-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-1" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#fff2cc;strokeColor=#d6b656;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="1390" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-2" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="340" y="1200" width="300" height="130" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-3" value="Redis Sentinel" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;align=center;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="435" y="1220" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-4" value="Redis Sentinel" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;align=center;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="360" y="1280" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-5" value="Redis Sentinel" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;sketch=1;fontSize=12;fontColor=#1A1A1A;align=center;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="530" y="1280" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-6" value="" style="endArrow=classic;startArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-4" target="v9Ph8Vd67jHW01WgXYZy-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="1340" as="sourcePoint" />
            <mxPoint x="440" y="1290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-7" value="" style="endArrow=classic;startArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-3" target="v9Ph8Vd67jHW01WgXYZy-5" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="417.5" y="1290" as="sourcePoint" />
            <mxPoint x="445" y="1245" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-8" value="" style="endArrow=classic;startArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-4" target="v9Ph8Vd67jHW01WgXYZy-5" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="427.5" y="1300" as="sourcePoint" />
            <mxPoint x="455" y="1255" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-14" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-11" target="v9Ph8Vd67jHW01WgXYZy-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="1440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-16" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-11" target="v9Ph8Vd67jHW01WgXYZy-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="337" y="1519" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-17" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0.48;entryY=1.031;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=12;fontColor=#1A1A1A;startArrow=block;startFill=1;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-11" target="v9Ph8Vd67jHW01WgXYZy-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="337" y="1334" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-11" value="Master" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="260" y="1450" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-18" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;fontSize=12;fontColor=#1A1A1A;startArrow=blockThin;startFill=1;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-13" target="v9Ph8Vd67jHW01WgXYZy-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="525" y="1379" />
              <mxPoint x="565" y="1379" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-13" value="Slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="480" y="1410" width="90" height="60" as="geometry" />
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.777;entryY=1.038;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=12;fontColor=#1A1A1A;startArrow=block;startFill=1;elbow=vertical;curved=1;" parent="nV-omL6sR25xKeSbgsDl-1" source="v9Ph8Vd67jHW01WgXYZy-15" target="v9Ph8Vd67jHW01WgXYZy-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="615" y="1335" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="v9Ph8Vd67jHW01WgXYZy-15" value="Slave" style="ellipse;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="580" y="1500" width="69" height="38" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-0" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis Sentinel&amp;nbsp; 负责持续监控主从节点的健康， 当主节点挂掉时， 自动选择一个最优的从节点切换为主节点 。客户端来连接集群时，会首先连接 sentinel , 通过 sentinel&amp;nbsp; 来查询主节点的地址， 然后再去连接主节点进行数据交互 。 当主节点发生故障时 ， 客户端会重新向sentinel 要地址 ， sentinel&amp;nbsp; 会将最新的主节点地址告诉客户端 ， 如此应用程序将无需重启即可自动完成节点切换。&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;故障转移时，判断一个master node 宕机了， 需要大部分的哨兵同意才行， 即使部分的哨兵节点挂掉了，哨兵集群还是能正常工作的，哨兵至少需要三个实例，来保证自己的健壮性，哨兵 + redis 主从架构，不能保证数据零丢失，只能保证高可用。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="1550" width="740" height="120" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-1" value="消息丢失" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="1690" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-2" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 主从采用异步复制，意味着当主节点挂掉时，从节点可能没有收到全部的同步消息 ， 这部分未同步的消息就丢失了，如果主从延迟特别大，那么丢失的数据就可能会特别多 ， Sentinel&amp;nbsp; 无法保证消息完全不丢失，但是尽可能保证消息少丢失 ， 它有两个选项可以闲置主从延迟过大：&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;min-slaves-to-write&amp;nbsp; 1 :&amp;nbsp; 主节点必须至少有一个从节点在进行正常复制 ，否则就停止对外写服务，丧失可用性&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;min-slaves-max-lag 10 ： 如果10s&amp;nbsp; 没有收到从节点的反馈 就意味着从节点同步不正常， 要么网络断开了， 要么一直没有给反馈&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="1750" width="700" height="140" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-3" value="Codis" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="40" y="2160" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-5" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-4" target="iuwdPfhdbmwhKgVp2Xaa-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="270" y="2275" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-4" value="Client" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="2250" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-10" style="edgeStyle=isometricEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-6" target="iuwdPfhdbmwhKgVp2Xaa-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-11" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=37.5;entryPerimeter=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;exitPerimeter=0;edgeStyle=isometricEdgeStyle;rounded=1;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-6" target="iuwdPfhdbmwhKgVp2Xaa-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-12" style="edgeStyle=isometricEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-6" target="iuwdPfhdbmwhKgVp2Xaa-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-6" value="Codis" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="270" y="2247.5" width="55" height="55" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-7" value="Redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="580" y="2190" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-8" value="Redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="540" y="2250" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-9" value="Redis" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rounded=1;shadow=1;glass=1;sketch=1;fontSize=12;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="580" y="2330" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-14" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Codis 使用Go 语言开发 ，它是一个代理中间件， 它和Redis 一样也使用 Redis 协议 对外提供服务，当客户端向codis 发送指令时 ，Codis 负责将指令转发到后面的Redis 实例 来执行 ，并将结果在转回给客户端。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;Codis 上挂接的所有Redis 实例构成了一个Redis集群 ，当集群的空间不足时 ， 可以通过动态增加Redis 实例来实现扩容需求。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="2400" width="740" height="100" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-15" value="Codis 分片原理" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="2520" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-16" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Codis 要负责将特定的key 转发到特定的Redis实例 。Codis 将所有的key 默认划分为 1024 个槽位 ，它首先对客户端传过来的key 进行crc32 运算， 计算hash值 ，在将hash 后的整数值 对1024 进行取模 ， 得到一个余数 ， 这个余数就是对应的槽位。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="2570" width="690" height="70" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--0" value="哨兵集群的发现机制" style="text;html=1;strokeColor=#10739e;fillColor=#b1ddf0;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="1910" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--1" value="&lt;p style=&quot;line-height: 180%&quot;&gt;哨兵之间的发现， 是通过 redis 的 pub/sub 系统实现的，每个哨兵都会往 _sentinel_:hello 这个channel 里发送一个消息 ，这时候所有其它的哨兵都可以消费到这个消息，并感知其它哨兵的存在。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;每隔两秒钟，每个哨兵都会往自己监控的某个 master + slaves 对应的 _sentinel_:hello channel 里发送一个消息 ，内容是自己的host&amp;nbsp; ip 和 runid&amp;nbsp; 还有对 master的监控配置&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;每个哨兵也会去监听自己监控的每个 master + slaves 对应的 _sentinel_:hello&amp;nbsp; channel&amp;nbsp; , 然后去感知同样在监听这个master+slave 的其它哨兵的存在。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;每个哨兵还会跟其它的哨兵交换对master 的配置，互相进行监控配置同步&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="1960" width="700" height="180" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-0" value="" style="group;rotation=-15;textOpacity=20;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1" connectable="0">
          <mxGeometry x="125" y="1670" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-1" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="05Gr9-nk4eHxLM6E-I-9-0" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-44" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;fontColor=#1A1A1A;align=center;dashed=1;fillColor=#FFE6CC;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="115" y="3861" width="595" height="70" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-17" value="Redis Cluster" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="40" y="2640" width="90" height="32" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-18" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis Cluster&amp;nbsp; 去中心化， 每个节点负责整个集群中的一部分数据，每个节点负责的数据多少可能不一样，这三个节点相互连接组成要给对等的集群，他们之间通过一种特殊的二进制协议相互交互集群信息。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="2923" width="690" height="50" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-19" value="cluster slots" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="330" y="3003" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-21" value="&lt;span&gt;cluster slots&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="150" y="3003" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-22" value="&lt;span&gt;cluster slots&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#bac8d3;strokeColor=#23445d;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="510" y="3003" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--2" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.394;entryY=1.05;entryDx=0;entryDy=0;entryPerimeter=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-23" target="iuwdPfhdbmwhKgVp2Xaa-21" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-23" value="Node" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#fad7ac;strokeColor=#b46504;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="190" y="3063.21" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-27" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-24" target="iuwdPfhdbmwhKgVp2Xaa-19" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-29" style="edgeStyle=isometricEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;startArrow=classicThin;startFill=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-24" target="iuwdPfhdbmwhKgVp2Xaa-23" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-24" value="Node" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="390" y="3063.21" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-28" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-25" target="iuwdPfhdbmwhKgVp2Xaa-22" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-25" value="Node" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fontSize=12;align=center;fillColor=#fad9d5;strokeColor=#ae4132;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="570" y="3093.21" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-31" style="rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=block;startFill=1;fontSize=12;fontColor=#1A1A1A;edgeStyle=orthogonalEdgeStyle;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-23" target="iuwdPfhdbmwhKgVp2Xaa-25" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-30" style="edgeStyle=isometricEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=open;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" source="iuwdPfhdbmwhKgVp2Xaa-24" target="iuwdPfhdbmwhKgVp2Xaa-25" edge="1">
          <mxGeometry x="40" y="2861" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-32" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis Cluster 将所有的数据划分为16384个 slots ,&amp;nbsp; &amp;nbsp;每个节点负责其中一部分槽位，槽位的信息存储于每个节点中。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;当Redis Cluster 的客户都来连接集群时 ，它也会得到一份集群的槽位配置信息，这样当客户端要查找某个key 时 ，可以直接定位到目标节点。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;客户端为了可以直接定位某个具体的key所在的节点 ， 它需要缓存槽位相应的信息 ，这样才可以准确快速的定位到相应的节点。同时因为槽位的信息可能会存在客户端与服务器不一致的情况 ，还需要纠正机制来实现槽位信息的校验调整。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="3211" width="740" height="140" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-33" value="槽位定位算法" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="3401" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-34" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Cluster 默认会对key值使用crc16 算法，进行hash 得到一个整数值 ，然后用这个整数对16384进行取模来得到具体的槽位。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;Cluster 还允许用户强制某个key 挂在特定的槽上，通过在key 字符串里面嵌入 [ tag ] 标记 ，这样就可以强制key 所挂载的槽位等于 tag 所在的槽位。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;hash slot 让 node 的增加和移除很简单，增加一个master ，就将其它master 的hash slot 移动部分过去，减少一个master&amp;nbsp; , 就将它的hash slot 移动到其它的master 节点上&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="3461" width="700" height="130" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-35" value="跳转" style="text;html=1;strokeColor=#0e8088;fillColor=#b0e3e6;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="3621" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-36" value="&lt;p style=&quot;line-height: 180%&quot;&gt;当客户端向一个错误的节点发出了指令，该节点会发现指令的key 所在的槽位并不归自己管理 ，这时它会向客户端发送一个特殊的跳转指令 ，携带目标操作的节点地址，告诉客户端去连这个节点获取数据。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="3671" width="700" height="70" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-37" value="迁移" style="text;html=1;strokeColor=#0e8088;fillColor=#b0e3e6;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;sketch=1;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="3761" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-38" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 迁移的单位是槽 ， Redis 一个槽 一个槽进行迁移 ，当一个槽正在迁移时 ， 这个槽就处于中间过渡状态 ，&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="3811" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-39" value="从源节点获取内容" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="3881" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-40" value="" style="shape=flexArrow;endArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" edge="1">
          <mxGeometry x="40" y="2861" width="50" height="50" as="geometry">
            <mxPoint x="240" y="3891" as="sourcePoint" />
            <mxPoint x="330" y="3901" as="targetPoint" />
            <Array as="points">
              <mxPoint x="300" y="3891" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-41" value="存到目标节点" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="355" y="3891" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-42" value="" style="shape=flexArrow;endArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" edge="1">
          <mxGeometry x="40" y="2861" width="50" height="50" as="geometry">
            <mxPoint x="460" y="3901" as="sourcePoint" />
            <mxPoint x="550" y="3891" as="targetPoint" />
            <Array as="points">
              <mxPoint x="520" y="3901" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iuwdPfhdbmwhKgVp2Xaa-43" value="从源节点删除内容" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="580" y="3881" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--3" value="&lt;p style=&quot;line-height: 180%&quot;&gt;自动的将数据进行分片，每个master 上存放一部分的数据，提供了内置的高可用支持，部分master 不可用时，可以继续工作&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="80" y="3171" width="690" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--4" value="&lt;p style=&quot;line-height: 180%&quot;&gt;一次性获取源节点槽位的所有的key 列表，在挨个key 进行迁移，每个key的迁移过程是以源节点作为目标节点的【客户端】 ，源节点对当前key 执行dump 指令得到序列化的内容，然后通过 【客户端】向目标节点发送指令 restore 携带序列化的内容作为参数，目标节点在反序列化就可以将内容恢复到目标节点内存中，然后返回[客户端] ok&amp;nbsp; , 源节点【客户端】收到后再把当前节点的key 删除就完成了单个key 迁移的整个过程。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="3951" width="700" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KuQuA2hBz4Mn9g1Wm6L--5" value="&lt;p style=&quot;line-height: 180%&quot;&gt;迁移过程是同步的，在目标节点执行restore 指令到源节点删除key之间，源节点的主线程会处于阻塞状态，直到key被成功删除。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="120" y="4041" width="700" height="40" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-2" value="" style="group;rotation=-15;textOpacity=20;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1" connectable="0">
          <mxGeometry x="115" y="3031" width="700" height="130" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-3" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="05Gr9-nk4eHxLM6E-I-9-2" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-4" value="" style="group;rotation=-15;textOpacity=20;" parent="05Gr9-nk4eHxLM6E-I-9-2" vertex="1" connectable="0">
          <mxGeometry x="30" y="877.79" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="05Gr9-nk4eHxLM6E-I-9-5" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="05Gr9-nk4eHxLM6E-I-9-4" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;endArrow=openThin;endFill=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="23tLzSuujafjZIG68ccP-2" target="23tLzSuujafjZIG68ccP-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=openThin;endFill=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="23tLzSuujafjZIG68ccP-2" target="23tLzSuujafjZIG68ccP-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-2" value="master" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="255" y="2720" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-3" value="slave" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="205" y="2810" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-4" value="slave" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="345" y="2810" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=openThin;endFill=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="23tLzSuujafjZIG68ccP-5" target="23tLzSuujafjZIG68ccP-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endArrow=openThin;endFill=0;" parent="nV-omL6sR25xKeSbgsDl-1" source="23tLzSuujafjZIG68ccP-5" target="23tLzSuujafjZIG68ccP-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-5" value="master" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="475" y="2720" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-6" value="slave" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="425" y="2810" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-7" value="slave" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=0;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="565" y="2810" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="23tLzSuujafjZIG68ccP-13" value="集群" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=0;sketch=0;opacity=50;" parent="nV-omL6sR25xKeSbgsDl-1" vertex="1">
          <mxGeometry x="380" y="2710" width="40" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="NWDxtzFDo4rWd0rjsQyk" name="扩展">
    <mxGraphModel dx="868" dy="-1846" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="y6MDonX61XFysDYpfcKY-0" />
        <mxCell id="y6MDonX61XFysDYpfcKY-1" parent="y6MDonX61XFysDYpfcKY-0" />
        <mxCell id="33S8CbwOZ9GGTe3CevOu-0" value="Stream" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="40" y="2360" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-0" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 5.0后，新增的数据结构 ，它是一个新的强大的支持多播的可持久化的消息队列&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="80" y="2420" width="690" height="50" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-1" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="80" y="2480" width="640" height="300" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-2" value="Stream" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;sketch=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="110" y="2500" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-3" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-4" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="170" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-5" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="220" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-7" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="270" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-8" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="320" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-9" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="370" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-11" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="420" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-12" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="470" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-13" value="" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#FFFFFF;fontSize=12;fontColor=#1A1A1A;align=center;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="520" y="2660" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-18" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=open;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-14" target="N6o6JetXOCWTZSmZDfl9-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-14" value="Consumer Group&lt;br&gt;last_delivered_id" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#fad7ac;fontSize=12;align=center;strokeColor=#b46504;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="188.75" y="2540" width="112.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-19" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=open;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-15" target="N6o6JetXOCWTZSmZDfl9-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-28" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-15" target="N6o6JetXOCWTZSmZDfl9-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="2565" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-30" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-15" target="N6o6JetXOCWTZSmZDfl9-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="2615" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-15" value="Consumer Group&lt;br&gt;last_delivered_id" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#fad7ac;fontSize=12;align=center;strokeColor=#b46504;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="393.75" y="2540" width="102.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-17" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=open;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-16" target="N6o6JetXOCWTZSmZDfl9-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-16" value="Consumer Group&lt;br&gt;last_delivered_id" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#fad7ac;fontSize=12;align=center;strokeColor=#b46504;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="246.88" y="2720" width="96.25" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-24" value="" style="group" parent="y6MDonX61XFysDYpfcKY-1" vertex="1" connectable="0">
          <mxGeometry x="280" y="2620" width="112.5" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-22" value="" style="endArrow=classic;html=1;fontSize=12;fontColor=#1A1A1A;" parent="N6o6JetXOCWTZSmZDfl9-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="10" y="20" as="sourcePoint" />
            <mxPoint x="112.5" y="20" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-23" value="stream direction" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=12;fontColor=#1A1A1A;" parent="N6o6JetXOCWTZSmZDfl9-24" vertex="1">
          <mxGeometry width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-25" value="Consumer&lt;br&gt;pending_ids[]" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#b1ddf0;fontSize=12;align=center;strokeColor=#10739e;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="570" y="2490" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-31" value="Consumer&lt;br&gt;pending_ids[]" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#b1ddf0;fontSize=12;align=center;strokeColor=#10739e;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="570" y="2545" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-32" value="Consumer&lt;br&gt;pending_ids[]" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#b1ddf0;fontSize=12;align=center;strokeColor=#10739e;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="570" y="2600" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" source="N6o6JetXOCWTZSmZDfl9-33" target="N6o6JetXOCWTZSmZDfl9-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-33" value="Message Content" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;fillColor=#bac8d3;fontSize=12;align=center;strokeColor=#23445d;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="410" y="2720" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-35" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis Stream 的结构如上图所示， 它有一个消息链表， 将所有加入的消息都串联起来 ， 每个消息都有一个唯一的ID 和对应的内容 ，消息是持久化的，Redis 重启后， 内容还在 。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="80" y="2800" width="690" height="50" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-36" value="Info&amp;nbsp;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="40" y="2880" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-37" value="分布式锁" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="40" y="3000" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-38" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 会将设置了过期时间的key 放入一个独立的字典中，以后会定期的遍历整个字典来删除到期的key , 除了定时遍历之外 ， 它还会使用惰性策略来删除过期的key , 所谓的惰性策略就是在客户端访问整个key的时候 ，redis 对key的过期时间进行检查，如果过期了就立即删除，定时删除时集中处理 ，&amp;nbsp; 惰性删除是零散处理。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#1A1A1A;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3260" width="690" height="80" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-39" value="过期策略" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="40" y="3120" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-40" value="过期key的集合" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-41" value="定时扫描策略" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3360" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-42" value="&lt;p style=&quot;line-height: 180%&quot;&gt;Redis 默认会每秒进行10次过期扫描 ，过期扫描不会遍历过期字典中所有的key , 而是采用了一种简单的贪心策略。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;1. 从过期字典中随机20个key&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;2. 删除这20个key 中已经过期的key&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;3. 如果过期的key的比例超过 1/4 那就重复步骤1&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;同时为了保证过期扫描不会出现循环过度 ， 导致线程卡死现象，算法还增加了扫描时间的上限 ，默认不会超过25ms&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fillColor=#FFFFFF;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3420" width="690" height="180" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-43" value="从库的过期策略" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3620" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-44" value="&lt;p style=&quot;line-height: 180%&quot;&gt;从库不会进行过期扫描 ，从库对过期的处理是被动的，主库在key 到期时 ，会在AOF 文件里增加一条del 指令，同步到所有的从库，从库通过执行这条del&amp;nbsp; 指令来删除过期的key.&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;因为指令同步是异步进行的，所以主库过期的key 的del 指令没有及时同步到从库的话 ， 会出现主从数据的不一致，主库没有的数据，从库里还存在&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fillColor=#FFFFFF;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="3680" width="690" height="100" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-45" value="LRU" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="40" y="3800" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-46" value="&lt;p style=&quot;line-height: 180%&quot;&gt;当Redis 内存超过物理内存限制时 ，内存的数据会开始和磁盘产生频繁的交换，交换会让Redis的性能急剧的下降。对于访问量比较频繁的Redis来说， 这样龟速的存储效率基本上等于不可用。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;noeviction&amp;nbsp; &amp;nbsp;volatile-lru&amp;nbsp; volatile-ttl volatile-random allkeys-lru allkeys-random volatile-xxx&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fillColor=#FFFFFF;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="80" y="3860" width="690" height="100" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-47" value="LRU 算法" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="80" y="3980" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="N6o6JetXOCWTZSmZDfl9-48" value="&lt;p style=&quot;line-height: 180%&quot;&gt;实现LRU 算法 除了需要 [ key-value ] 字典之外 ， 还需要附加一个链表 ， 链表中的元素按照一定的顺序进行排序。 当空间满时，会踢掉链表尾部的元素 ，当字典的某个元素被访问时， 它在链表中的位置会被移动到表头。所以链表的元素排列顺序就是元素最近被访问的时间顺序。&lt;/p&gt;&lt;p style=&quot;line-height: 180%&quot;&gt;位于链表尾部的元素就是不被重用的元素，所以会被剔除掉， 位于表头的元素就是最近刚刚被人用过的元素 ，所以此时不会被踢&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fillColor=#FFFFFF;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1">
          <mxGeometry x="120" y="4042" width="690" height="100" as="geometry" />
        </mxCell>
        <mxCell id="aSEERD5IaM7irzctgVsJ-0" value="" style="group;rotation=-15;textOpacity=20;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1" connectable="0">
          <mxGeometry x="89" y="2730" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="aSEERD5IaM7irzctgVsJ-1" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="aSEERD5IaM7irzctgVsJ-0" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="aSEERD5IaM7irzctgVsJ-2" value="" style="group;rotation=-15;textOpacity=20;" parent="y6MDonX61XFysDYpfcKY-1" vertex="1" connectable="0">
          <mxGeometry x="120" y="3660" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="aSEERD5IaM7irzctgVsJ-3" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="aSEERD5IaM7irzctgVsJ-2" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="enyd1SQA_xRLsmPlYawQ" name="深度极寒">
    <mxGraphModel dx="868" dy="492" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="R8Xmmlt4IPB7zrE09Ldw-0" />
        <mxCell id="R8Xmmlt4IPB7zrE09Ldw-1" parent="R8Xmmlt4IPB7zrE09Ldw-0" />
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-0" value="字符串 内部结构" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="40" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-1" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 中的字符串是可以修改的字符串，在内存中它是以字节数组的形式存在的。Redis的字符串 叫 SDS , Simple Dynamic String 。他的结构是一个带长度信息的字节数组&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;字符串的长度在小于1M之前 ，扩容空间采用加倍策略 ，也就是保留 100% 的冗余空间，当长度超过1M 之后，为了避免加倍后冗余空间过大而导致浪费，每次扩容只会多分配1M大小的冗余空间&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="100" width="740" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-2" value="字典 内部结构" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="240" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-3" value="&lt;p style=&quot;line-height: 200%&quot;&gt;dict 是 Redis服务器中出现最为频繁的复合型数据结构 ，除了hash 结构的数据会用到字典外，整个Redis 数据库的所有的key 和 value 也醉成了一个全局字典，还有带有过期时间的key 集合也是一个字典，zset 集合中存储的　value 和 score 值得映射关系也是通过dict 结构实现的。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="300" width="740" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-4" value="set 内部结构" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="410" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-5" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 里面set的结构底层也是字典，之不过所有的value 都是 NULL ,&amp;nbsp; 其它的特性和字典一样。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="470" width="740" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-6" value="压缩列表" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="520" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-7" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 为了节约内存空间使用，zset 和 hash 容器对象在元素个数较少的时候，采用压缩列表（ziplist） 进行存储，压缩列表是一块连续的空间，元素之间紧挨着存储，没有任何冗空隙&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="585" width="740" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-8" value="快速列表" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="640" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-10" value="跳跃列表" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="720" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-11" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 的 zset 是一个复合结构，一方面它需要一个hash 结构来存储 value 和 score 的对应关系 ，另外一个方面需要按照score 来排序功能，还需要能够执行score 的范围获取value 列表的功能。这就需要另外的一个结构&amp;nbsp; 跳跃列表&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="780" width="740" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-34" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="130" y="940.5" as="sourcePoint" />
            <mxPoint x="200" y="940.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-40" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-28" target="Ob7KSYr4x1QFicvUf9MM-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-41" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.178;exitDx=0;exitDy=0;entryX=-0.025;entryY=0.178;entryDx=0;entryDy=0;startArrow=none;startFill=0;exitPerimeter=0;entryPerimeter=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-28" target="Ob7KSYr4x1QFicvUf9MM-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-43" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-28" target="Ob7KSYr4x1QFicvUf9MM-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-46" value="①" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Ob7KSYr4x1QFicvUf9MM-43" vertex="1" connectable="0">
          <mxGeometry x="-0.3886" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-28" value="kv head" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=left;fillColor=#ffcccc;strokeColor=#36393d;sketch=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="860" width="50" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-29" value="kv" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="200" y="920" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-44" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-30" target="Ob7KSYr4x1QFicvUf9MM-31" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="850" />
              <mxPoint x="320" y="850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-47" value="②" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Ob7KSYr4x1QFicvUf9MM-44" vertex="1" connectable="0">
          <mxGeometry x="-0.4133" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-30" value="kv" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=center;fillColor=#fad7ac;strokeColor=#b46504;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="420" y="860" width="40" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-45" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-31" target="Ob7KSYr4x1QFicvUf9MM-32" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="340" y="830" />
              <mxPoint x="550" y="830" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-48" value="③" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Ob7KSYr4x1QFicvUf9MM-45" vertex="1" connectable="0">
          <mxGeometry x="0.3167" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-31" target="Ob7KSYr4x1QFicvUf9MM-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-31" value="kv" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=center;fillColor=#d0cee2;strokeColor=#56517e;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="310" y="890" width="40" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-32" value="kv" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="530" y="920" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-33" value="kv" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=center;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="640" y="920" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-36" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="942" as="sourcePoint" />
            <mxPoint x="310" y="942" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-37" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="934.5" as="sourcePoint" />
            <mxPoint x="420" y="934.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-38" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="934.5" as="sourcePoint" />
            <mxPoint x="530" y="934.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-39" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=openThin;startFill=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="934.5" as="sourcePoint" />
            <mxPoint x="640" y="934.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-42" value="&lt;p style=&quot;line-height: 200%&quot;&gt;Redis 的跳跃表共有64层，意味着最多可以容纳 2的64 次方个元素 ， 对于每一个新插入的节点，都需要调用一个随机算法给它分配要给合理的层数&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="80" y="990" width="740" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Ob7KSYr4x1QFicvUf9MM-49" value="紧凑列表" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1">
          <mxGeometry x="40" y="1130" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-3" value="" style="endArrow=none;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" source="Ob7KSYr4x1QFicvUf9MM-28" target="Ob7KSYr4x1QFicvUf9MM-28" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="40" y="1010" as="sourcePoint" />
            <mxPoint x="90" y="960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-4" value="" style="endArrow=none;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="80" y="890" as="sourcePoint" />
            <mxPoint x="130" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-5" value="" style="endArrow=none;html=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="310" y="920" as="sourcePoint" />
            <mxPoint x="350" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-6" value="" style="endArrow=none;html=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="920" as="sourcePoint" />
            <mxPoint x="460" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="IBC3VaC30Nt8yrkGzKnn-7" value="" style="endArrow=none;html=1;" parent="R8Xmmlt4IPB7zrE09Ldw-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="880" as="sourcePoint" />
            <mxPoint x="460" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HwfDgC5BpMnmd-p-qhcY-0" value="" style="group;rotation=-15;textOpacity=20;" parent="R8Xmmlt4IPB7zrE09Ldw-1" vertex="1" connectable="0">
          <mxGeometry x="140" y="740" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="HwfDgC5BpMnmd-p-qhcY-1" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="HwfDgC5BpMnmd-p-qhcY-0" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="4FsPZaoSf79rtmNonRwa-0" value="跳跃表在链表的基础上， 增加多级索引提升查找效率" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="R8Xmmlt4IPB7zrE09Ldw-1">
          <mxGeometry x="80" y="1050" width="320" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="wrkVmGegcRjDCWmV76kZ" name="线上故障">
    <mxGraphModel dx="868" dy="492" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="uUWCNbAPGHeyCcKTkVrY-0" />
        <mxCell id="uUWCNbAPGHeyCcKTkVrY-1" parent="uUWCNbAPGHeyCcKTkVrY-0" />
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-0" value="缓存雪崩" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="40" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-1" value="缓存击穿" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="400" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-2" value="缓存穿透" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="35" y="540" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="M1zMZmoeTWhk0v8dZeMA-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="135" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-3" value="用户" style="ellipse;whiteSpace=wrap;html=1;labelBackgroundColor=none;sketch=1;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="70" y="120" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-6" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="M1zMZmoeTWhk0v8dZeMA-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="135" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-5" value="下单系统" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;sketch=1;align=center;fillColor=#f8cecc;strokeColor=#b85450;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="230" y="117.5" width="120" height="35" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=none;startFill=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="M1zMZmoeTWhk0v8dZeMA-7" target="M1zMZmoeTWhk0v8dZeMA-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="550" y="210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-11" value="无数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="M1zMZmoeTWhk0v8dZeMA-10" vertex="1" connectable="0">
          <mxGeometry x="0.4452" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-14" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="M1zMZmoeTWhk0v8dZeMA-7" target="M1zMZmoeTWhk0v8dZeMA-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-15" value="有数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="M1zMZmoeTWhk0v8dZeMA-14" vertex="1" connectable="0">
          <mxGeometry x="-0.2238" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-7" value="查询缓存" style="rhombus;whiteSpace=wrap;html=1;labelBackgroundColor=none;sketch=1;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="440" y="95" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="M1zMZmoeTWhk0v8dZeMA-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-12" value="数据库" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;sketch=1;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="490" y="188" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-16" value="&lt;p style=&quot;line-height: 200%&quot;&gt;缓存雪崩：同一个时间缓存大面积失效，大量的请求直接向数据拿数据，直接把MySQL 打死。如果不考虑限流熔断的情况，那将是灾难性的后果，前端的请求已经超过了数据库能支持的流量极限，重启数据库也无济于事，因为启动成功之后，面临的是接着被打死。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="85" y="240" width="735" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-17" value="&lt;p style=&quot;line-height: 200%&quot;&gt;解决方案， 定时任务写入缓存数据的时候，给缓存的过期时间添加一个随机值， 让缓存的失效的实现相对分散，不要在同一时间集中过期。或者设置缓存不过期&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="320" width="735" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-18" value="&lt;p style=&quot;line-height: 200%&quot;&gt;某一个key 非常的热点，大量的并发都对整个key 进行访问，当这个key 在失效的瞬间，持续的大并发就穿破缓存，直接请求到数据库中，从而打崩数据库。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;使用互斥锁方案&amp;nbsp; ， 永不过期&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="77.5" y="450" width="735" height="60" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-19" value="&lt;p style=&quot;line-height: 200%&quot;&gt;请求越过了缓存，直接请求到了数据库中， 数据库种也查不到对应的结果，比如一些恶意的请求。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;针对这种情况，业务层要对参数做校验，将一些非法的参数拦截在业务层。如果数据库中也没有查询到结果，就在Redis 种缓存 空值， 并给一个过期时间 ； 还可以使用布隆过滤器，&amp;nbsp; 但是布隆过滤器有误判， 数据可能存在，但是判断可能是不存在，会查询数据库，但是误判的概率相抵可控，它判断不存在，数据就是不存在，可以直接拦截。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="580" width="735" height="110" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-20" value="&lt;p style=&quot;line-height: 200%&quot;&gt;为了避免上述情况的发生，一般针对三个时间段去进行分析：&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;事前： Redis 要保证高可用 ，这样即使某一台redis 宕机，还有其它的redis能对外提供服务， 可以 主从 + 哨兵&amp;nbsp; 或者&amp;nbsp; Redis Cluster 部署&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;事中： 本地缓存 + 限流降级，&amp;nbsp; 避免 数据库被打死&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;事后： Redis 要开启持久化的机制， 并做好备份 ， 一旦重启，能快速的恢复Redis 中的缓存数据。&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="720" width="735" height="140" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-21" value="缓存与数据库双写一致性" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="880" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-0" value="&lt;p style=&quot;line-height: 0px; font-size: 13px;&quot;&gt;最经典的缓存 + 数据库读写的模式： Cache Aside Pattern&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 24px; font-size: 13px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 读的时候先读缓存 ，缓存没有的话在读数据库， 然后取出数据后，在放入缓存中，同时返回响应&lt;/p&gt;&lt;p style=&quot;line-height: 24px; font-size: 13px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 更新的时候 ，先删除缓存，在更新数据库，休眠一下 在删除缓存 ， 延时双删策略&lt;/p&gt;&lt;p style=&quot;line-height: 24px; font-size: 13px;&quot;&gt;延时双删策略其实还是有问题，如果第二次删除缓存失败了，同时在第一个删除完成之后，更新操作完成之前，来一个查询请求，那么此时缓存的数据就是更新之前的数据，也会有不一致的问题，当然这种是概率的问题，如果业务中不允许出现这样的不一致情况，延时双删策略可能不太合适。分布式环境中，想要保证数据一致性，是一件极其困难的事，只能尽可能的降低这种数据不一致产生的情况。&lt;/p&gt;&lt;p style=&quot;line-height: 24px; font-size: 13px;&quot;&gt;如果要保证缓存和数据库的强一致，那就要做串行化操作， 将请求压入队列，在更新操作完成之前，不做读操作。这样其实又带来了两外的一个问题，系统的性能受到影响，串行化后，可能导致大量的读请求 阻塞 ，要解决这个问题，只能是根据并发量 增加机器，增加服务实例的数量，来提高系统的吞吐量&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;fontSize=13;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="940" width="735" height="300" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-1" value="并发竞争" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="43" y="2060" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-2" value="&lt;p style=&quot;line-height: 200%&quot;&gt;多客户端同时并发写入一个key , 本来应该先到的数据后到了，导致数据版本错了，或者是多个客户同时获取一个key ,修改值之后再写回去&lt;/p&gt;&lt;p style=&quot;line-height: 0px&quot;&gt;只要顺序错了， 数据就错了。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="73" y="2100" width="735" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-3" value="zookeeper" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;sketch=1;align=center;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="348" y="2164" width="82" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-4" value="缓存" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;shadow=0;labelBackgroundColor=none;sketch=1;align=center;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="370" y="2294" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-8" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-5" target="xCT3tCEGww_5zrkCECiz-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-11" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=37.5;entryPerimeter=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-5" target="xCT3tCEGww_5zrkCECiz-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-5" value="A" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;sketch=1;align=center;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="250" y="2224" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-9" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-6" target="xCT3tCEGww_5zrkCECiz-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-12" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-6" target="xCT3tCEGww_5zrkCECiz-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-6" value="B" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;sketch=1;align=center;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="365" y="2224" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-10" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-7" target="xCT3tCEGww_5zrkCECiz-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-13" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=37.5;entryPerimeter=0;startArrow=none;startFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="xCT3tCEGww_5zrkCECiz-7" target="xCT3tCEGww_5zrkCECiz-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-7" value="C" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;labelBackgroundColor=none;sketch=1;align=center;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="470" y="2224" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xCT3tCEGww_5zrkCECiz-14" value="&lt;p style=&quot;line-height: 200%&quot;&gt;使用 zookeeper 的 分布式锁， 天然的是公平锁，可以保证请求的顺序性，避免数据错乱。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;写入缓存的数据都是从数据库中查询出来的， 一般数据库中表的字段中都有一个&amp;nbsp; update_time 时间戳，每次在写之前，需要先判断一下，缓存中的 时间戳和要写入数据的时间戳 ， 如果缓存中时间戳比 要更新的时间错新的话，此次操作就不能执行。&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="2374" width="735" height="110" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-0" value="&lt;p style=&quot;line-height: 200%&quot;&gt;上面比较粗略的介绍了缓存中可能出现的一些问题和相应的解决方案，下面再来总结一下：&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 缓存过期后，将尝试从后端数据库获取数据，这是一个看似非常合理的流程。但是在高并发场景下，有可能有多个请求去从数据库获取数据，对后端数据库造成极大的冲击 ，甚至导致 「宕机」 的现象。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 此外，当某个缓存key 在被更新时，同时也可能被大量请求在获取，这也会导致不一致的问题。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;那如何避免类似的问题呢 ？&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 很自然的会想到加锁的机制，在缓存更新或者过期的情况下，先尝试获取锁，当更新或者从数据库获取到数据后在释放锁，其它的请求需要牺牲一定的等待时间 ，即可直接从缓存中获取数据。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;缓存穿透：&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;在高并发场景下，如果某一个key 被高并发访问，没有被命中，处于对容错性的考虑，会尝试从数据库中获取，从而导致了大量的请求到达了数据库，而当该key对应的数据本身就是NULL 的情况下，这就导致了数据库中并发的执行了很多不必要的查询操作，从而导致巨大冲击和压力。&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 可以通过下面的两种方式来避免缓存穿透的问题：&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 1. 缓存空对象&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 2. 单独过滤处理&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="2494" width="735" height="490" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-2" value="分布式锁的实现原理" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="2984" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-3" value="&lt;p style=&quot;line-height: 200%&quot;&gt;分布式锁，业界比较流行和工业级使用的方案都是 Redisson ，当然也可以使用 set方法来实现，但是需要手动实现逻辑，既然已经有了成熟的方案，还是不要重复造轮子了，下面就来聊一聊 Redisson 的实现原理。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="3024" width="735" height="90" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="220" y="3186" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-26" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-5" target="7whBfMgbD_qqsudYZGVB-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="160" y="3314" as="targetPoint" />
            <Array as="points">
              <mxPoint x="160" y="3275" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-36" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.55;entryDx=0;entryDy=0;entryPerimeter=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-5" target="7whBfMgbD_qqsudYZGVB-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="140" y="3415" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-5" value="客户端 - redisson" style="ellipse;whiteSpace=wrap;html=1;rotation=5;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="60" y="3152.68" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-7" target="7whBfMgbD_qqsudYZGVB-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="3186" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-23" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-7" target="7whBfMgbD_qqsudYZGVB-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="3186" />
              <mxPoint x="560" y="3240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-24" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-7" target="7whBfMgbD_qqsudYZGVB-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="3186" />
              <mxPoint x="560" y="3300" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-7" value="根据&amp;nbsp; hash算法选择一个节点" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="220" y="3169.68" width="90" height="32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-14" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-9" target="7whBfMgbD_qqsudYZGVB-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="687.4999999999909" y="3307.3399999999997" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-9" value="master" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="620" y="3169.68" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-11" value="Redis 集群" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="540" y="3104" width="70" height="21.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-13" value="slave" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="742.5" y="3169.68" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-15" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-16" target="7whBfMgbD_qqsudYZGVB-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-16" value="master" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="620" y="3284" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-17" value="slave" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="730" y="3284" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-18" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-19" target="7whBfMgbD_qqsudYZGVB-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-19" value="master" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="620" y="3224" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-20" value="slave" style="ellipse;whiteSpace=wrap;html=1;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="737.5" y="3224" width="65" height="31.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-22" value="lua 脚本加锁" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="340" y="3164" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-28" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-27" target="7whBfMgbD_qqsudYZGVB-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="270" y="3374" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-27" value="加锁成功" style="rhombus;whiteSpace=wrap;html=1;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="200" y="3235.32" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-30" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="3194" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-29" value="watch dog&amp;nbsp;&lt;br&gt;看门狗" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="290" y="3334" width="70" height="40" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-31" value="锁有效期 30s" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="450" y="3152.68" width="90" height="11.32" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-33" value="没隔10s 看一下&lt;br&gt;如果还持有锁&lt;br&gt;延长生存时间" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="290" y="3250.32" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-35" value="如果释放锁，就直接删除 Lock 的那个key" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="175" y="3404" width="230" height="20" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-38" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="3497" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-37" value="客户端 - redisson" style="ellipse;whiteSpace=wrap;html=1;rotation=5;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="55" y="3464" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-40" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-39" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="3194" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="3494" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-41" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="7whBfMgbD_qqsudYZGVB-39" target="7whBfMgbD_qqsudYZGVB-37" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="285" y="3564" />
              <mxPoint x="92" y="3564" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-39" value="能否加锁" style="rhombus;whiteSpace=wrap;html=1;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="245" y="3454" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-42" value="while 循环 等待" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="130" y="3544" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="7whBfMgbD_qqsudYZGVB-43" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="290" y="3544" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="W2EOOQv8Cj7B72yQ1AWK-0" value="锁的自动续期" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="3584" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="W2EOOQv8Cj7B72yQ1AWK-1" value="&lt;p style=&quot;line-height: 200%&quot;&gt;加锁成功之后 ，就会启动一个后台线程 watch dog 看门狗 ， 会每隔10s 检查一下 ，当前客户端是否还持有锁 key ， 如果还持有，就会不断的延长锁 key 的生存时间。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="92" y="3214" width="735" height="90" as="geometry" />
        </mxCell>
        <mxCell id="W2EOOQv8Cj7B72yQ1AWK-2" value="&lt;p style=&quot;line-height: 200%&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;缺陷：&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 200%&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Redisson 是对某一个master&amp;nbsp; 进行加锁，如果加锁成功了，slave 还没有完成数据的复制，master 宕机了，此时执行主备切换， redis 的 slave 变成了 master ，就会导致 另一个客户端来加锁的时候，直接加锁成功，就会导致 多个客户端对一个分布式锁完成了加锁，这时系统业务语义上就会出现问题，导致脏数据的产生。&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="80" y="3714" width="735" height="90" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-2" value="" style="group;rotation=-15;textOpacity=20;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1" connectable="0">
          <mxGeometry x="70" y="205" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-3" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="qeulV645QN60k744e97G-2" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-4" value="" style="group;rotation=-15;textOpacity=20;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1" connectable="0">
          <mxGeometry x="120" y="990" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-5" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="qeulV645QN60k744e97G-4" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-6" value="" style="group;rotation=-15;textOpacity=20;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1" connectable="0">
          <mxGeometry x="64" y="3424" width="650" height="130" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-7" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="qeulV645QN60k744e97G-6" vertex="1">
          <mxGeometry x="30" y="12" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="qeulV645QN60k744e97G-1" value="&lt;span style=&quot;font-size: 49px&quot;&gt;&lt;font color=&quot;#b3b3b3&quot;&gt;蚂蚁不是ant - Mr.pan&lt;/font&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;sketch=0;opacity=40;textOpacity=20;rotation=-15;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="139" y="2604" width="575" height="110" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-23" value="redis 的 大 key" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="3834" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-24" value="Redis 的 热点key&amp;nbsp;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="3914" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-25" value="如何让 一组key&amp;nbsp; 都存储在一台 机器上" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="4104" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="M1zMZmoeTWhk0v8dZeMA-26" value="Redis&amp;nbsp; CPU&amp;nbsp; 100%" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="4154" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4rov-A6-OaIKI-HkXfAs-0" value="什么样的数据适合存放在Redis" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="4194" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4rov-A6-OaIKI-HkXfAs-1" value="持久化机制， 各有什么优缺点" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="4274" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-0" value="如何设计一个缓存策略 ，可以动态缓存热点数据？" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;shadow=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="40" y="4354" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endArrow=openThin;endFill=0;entryX=0;entryY=0.414;entryDx=0;entryDy=0;entryPerimeter=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="FxToyOXMAds_lEhUvf5q-1" target="FxToyOXMAds_lEhUvf5q-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="210" y="4484" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=openThin;endFill=0;" parent="uUWCNbAPGHeyCcKTkVrY-1" source="FxToyOXMAds_lEhUvf5q-1" target="FxToyOXMAds_lEhUvf5q-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-1" value="客户端" style="ellipse;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;opacity=50;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="45" y="4464" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-3" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="270" y="4424" width="390" height="70" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-4" value="商品1" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="294" y="4444" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-6" value="商品2" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="370" y="4444" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-7" value="商品3" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="450" y="4444" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-8" value="....." style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="530" y="4449" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-9" value="商品n" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="580" y="4444" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-10" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="270" y="4544" width="390" height="70" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-11" value="商品信息" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="294" y="4564" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-16" value="商品信息" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="394" y="4564" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-17" value="商品信息" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="477" y="4564" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-18" value="商品信息" style="rounded=0;whiteSpace=wrap;html=1;shadow=1;glass=0;sketch=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="580" y="4564" width="56" height="30" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-21" value="根据商品id 查询商品是否存在" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="55" y="4424" width="170" height="20" as="geometry" />
        </mxCell>
        <mxCell id="FxToyOXMAds_lEhUvf5q-22" value="通过商品id查询商品信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" parent="uUWCNbAPGHeyCcKTkVrY-1" vertex="1">
          <mxGeometry x="100" y="4544" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KabLdxtVOEFo3nRDZvIs-0" value="用户消费的数据 远大于生产的数据 ， 如秒杀 ， 热点新闻等读多写少的场景 ；&lt;br&gt;请求分片集中 ，超过单redis 服务器的性能 ， 比如固定名称 key" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="85" y="3954" width="470" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KabLdxtVOEFo3nRDZvIs-1" value="如何识别到热点 key ?&amp;nbsp; &amp;nbsp;凭经验判断哪些是热点key ； 客户端统计上报 ； 服务代理层 统计上报" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="80" y="4004" width="550" height="20" as="geometry" />
        </mxCell>
        <mxCell id="KabLdxtVOEFo3nRDZvIs-2" value="&lt;p style=&quot;line-height: 180%&quot;&gt;如何解决热key问题？ Redis 集群扩容 ，增加分片副本 ， 均衡读流量 ；&lt;br&gt;将热key 分散到不同的服务器中 ； 使用二级缓存，即本地JVM缓存，减少redis 读请求；&lt;/p&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="85" y="4024" width="520" height="80" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-0" value="第二次删除缓存失败 后的处理机制" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="80" y="1260" width="210" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-1" value="重试机制" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="100" y="1300" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-2" value="如果删除缓存失败， 则将删除失败的key 放入队列中 ，应用程序从队列中读取到key 值 ， 在次进行删除，如果还是失败， 则报警处理" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="42" y="1340" width="780" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-4" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="383.5" y="1470" as="targetPoint" />
            <mxPoint x="383.5" y="1440" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-3" value="写请求" style="ellipse;whiteSpace=wrap;html=1;fontSize=13;align=center;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="338.5" y="1400" width="90" height="40" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-6" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1" source="_nMWT1fpLIKslkGIO-HL-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="548.5" y="1485" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-10" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.645;entryY=0.02;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=13;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1" source="_nMWT1fpLIKslkGIO-HL-5" target="_nMWT1fpLIKslkGIO-HL-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;fontSize=13;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1" source="_nMWT1fpLIKslkGIO-HL-5" target="_nMWT1fpLIKslkGIO-HL-13">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="278.5" y="1485" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-17" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=13;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1" source="_nMWT1fpLIKslkGIO-HL-5" target="_nMWT1fpLIKslkGIO-HL-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-5" value="应用程序" style="rounded=1;whiteSpace=wrap;html=1;fontSize=13;align=center;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="338.5" y="1470" width="98" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-7" value="数据库" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=13;align=center;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="552" y="1455" width="60" height="65" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-8" value="&lt;font color=&quot;#00ff00&quot;&gt;① 更新数据库&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="443.5" y="1460" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-9" value="缓存" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=13;align=center;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="348.5" y="1580" width="62" height="50" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-11" value="② 删除缓存失败" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="395.5" y="1540" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fontSize=13;" edge="1" parent="uUWCNbAPGHeyCcKTkVrY-1" source="_nMWT1fpLIKslkGIO-HL-13" target="_nMWT1fpLIKslkGIO-HL-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-13" value="消息队列" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fontSize=13;align=center;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="178.5" y="1470" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-14" value="③ 放入队列" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="258.5" y="1490" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-16" value="④ 读取队列中的数据" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="228.5" y="1445" width="140" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-18" value="⑤ 再次删除" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="284.5" y="1545" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-19" value="读取binlog 异步删除缓存" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="50" y="1670" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="_nMWT1fpLIKslkGIO-HL-20" value="如果一个数据 更新的非常的频繁， 可能就不适合存放到缓存中给， 直接读取数据库就比较的合适" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=13;" vertex="1" parent="uUWCNbAPGHeyCcKTkVrY-1">
          <mxGeometry x="55" y="1720" width="570" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="oFjMoi1jTSt41ugqG1nr" name="redis 分布式锁">
    <mxGraphModel dx="868" dy="492" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-0" />
        <mxCell id="QOv29JMI8MwRSJFGYCb6-1" parent="QOv29JMI8MwRSJFGYCb6-0" />
        <mxCell id="QOv29JMI8MwRSJFGYCb6-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-2" target="QOv29JMI8MwRSJFGYCb6-9" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="95" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-2" value="" style="ellipse;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="50" y="70" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-3" value="Redisson客户端" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="45" y="130" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-4" value="" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="340" y="30" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-5" value="" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="360" y="40" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-6" value="" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="400" y="40" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-7" value="Redis 集群" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="475" y="20" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-9" target="QOv29JMI8MwRSJFGYCb6-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="340" y="195" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-9" value="获取锁对象" style="rounded=1;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="150" y="180" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-10" value="RedissonLock" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="155" y="210" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-13" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="490" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-12" value="调用lock方法" style="rounded=1;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="320" y="177.5" width="110" height="35" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-15" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-14" target="QOv29JMI8MwRSJFGYCb6-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-23" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="555" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-14" value="选取集群中的一个节点" style="rounded=1;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="490" y="150" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-16" value="crc16(key)&amp;nbsp; % 16384" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="520" y="100" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-20" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.014;entryY=1.05;entryDx=0;entryDy=0;entryPerimeter=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-18" target="QOv29JMI8MwRSJFGYCb6-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="670" y="220" as="targetPoint" />
            <Array as="points">
              <mxPoint x="640" y="226" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-18" value="执行LUA脚本" style="rounded=1;whiteSpace=wrap;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="490" y="205" width="117.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-19" value="锁的数据结构：&lt;br&gt;lockName:{&lt;br&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;UUID:ThreadId： 1&amp;nbsp;&lt;br&gt;&lt;br&gt;}" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="490" y="250" width="150" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-21" value="设置key值" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="680" y="212.5" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-22" value="设置过期时间" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="680" y="230" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-26" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="720" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-27" value="判断key 是否存在 存在就续期" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="QOv29JMI8MwRSJFGYCb6-26" vertex="1" connectable="0">
          <mxGeometry x="-0.2697" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-25" value="定时任务 10s执行一次" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="640" y="380" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-28" value="watch dog" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#d79b00;fillColor=#ffe6cc;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="725" y="350" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-29" value="客户端线程在底层是如何加锁的？" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="10" y="500" width="330" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-30" value="先定位 master 节点&amp;nbsp; 通过key 计算出 CRC 16值 ，在CRC16值对16384取模得到&amp;nbsp; hash slot ,&amp;nbsp; 通过这个hash slot 定位到 redis集群中得master 节点" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="45" y="540" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-31" value="加锁：通过 lua 脚本实现，如果客户端线程第一次取加锁得话，会在key 对应得hash数据结构中添加线程标识 UUID:ThreadId 1&amp;nbsp; 指定该线程已经枷锁一次了" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="45" y="570" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-32" value="加锁成功之后，此时会对加锁得结果设置一个监听器，如果监听成功了，后台会启动一个定时任务，也就是看门狗机制，每隔10s 执行一次， 检查 如果key 依然存在，就设置 key 得存活时间为 30s&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="40" y="610" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-33" value="" style="endArrow=classic;html=1;" parent="QOv29JMI8MwRSJFGYCb6-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="640" y="230" as="sourcePoint" />
            <mxPoint x="770" y="150" as="targetPoint" />
            <Array as="points">
              <mxPoint x="700" y="180" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-34" value="key 已经存在" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="QOv29JMI8MwRSJFGYCb6-33" vertex="1" connectable="0">
          <mxGeometry x="0.2192" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-36" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="950" y="150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-38" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="QOv29JMI8MwRSJFGYCb6-36" vertex="1" connectable="0">
          <mxGeometry x="0.4" y="-2" relative="1" as="geometry">
            <mxPoint x="-15" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-40" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="QOv29JMI8MwRSJFGYCb6-1" source="QOv29JMI8MwRSJFGYCb6-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="940" y="230" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-41" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="QOv29JMI8MwRSJFGYCb6-40" vertex="1" connectable="0">
          <mxGeometry x="-0.4308" y="-2" relative="1" as="geometry">
            <mxPoint x="10" y="6" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-35" value="判断是否是同一个线程" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="770" y="130" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-39" value="UUID:ThreadId&amp;nbsp; 2&amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="950" y="140" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-42" value="pttl&amp;nbsp; anyLock&amp;nbsp; 返回当前key 的剩余存活时间" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=#b85450;fillColor=#f8cecc;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="850" y="235" width="240" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QOv29JMI8MwRSJFGYCb6-43" value="while 循环" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="QOv29JMI8MwRSJFGYCb6-1" vertex="1">
          <mxGeometry x="860" y="270" width="70" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
